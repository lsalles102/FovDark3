
{% extends "base.html" %}

{% block title %}Comprar - FovDark{% endblock %}

{% block content %}
<section class="purchase-section">
    <div class="container">
        <div class="purchase-header">
            <h1>ESCOLHA SEU PLANO</h1>
            <p>Domine o campo de batalha com precisão absoluta</p>
        </div>

        <div class="pricing-cards">
            <div class="pricing-card">
                <div class="card-header">
                    <h3>MENSAL</h3>
                    <div class="price">
                        <span class="currency">R$</span>
                        <span class="amount">79</span>
                        <span class="cents">,90</span>
                    </div>
                    <div class="period">por mês</div>
                </div>
                <ul class="features">
                    <li><i class="fas fa-check"></i> Aim Assist Inteligente</li>
                    <li><i class="fas fa-check"></i> Anti-Detecção Ativo</li>
                    <li><i class="fas fa-check"></i> Suporte via Discord</li>
                    <li><i class="fas fa-check"></i> Atualizações Gratuitas</li>
                </ul>
                <button class="btn btn-primary" onclick="selectPlan('mensal', 79.90)">
                    ESCOLHER PLANO
                </button>
            </div>

            <div class="pricing-card featured">
                <div class="featured-badge">MAIS POPULAR</div>
                <div class="card-header">
                    <h3>TRIMESTRAL</h3>
                    <div class="price">
                        <span class="currency">R$</span>
                        <span class="amount">199</span>
                        <span class="cents">,90</span>
                    </div>
                    <div class="period">por 3 meses</div>
                    <div class="savings">Economize 17%</div>
                </div>
                <ul class="features">
                    <li><i class="fas fa-check"></i> Tudo do plano mensal</li>
                    <li><i class="fas fa-check"></i> Configurações Premium</li>
                    <li><i class="fas fa-check"></i> Suporte Prioritário</li>
                    <li><i class="fas fa-check"></i> Acesso Antecipado</li>
                </ul>
                <button class="btn btn-primary" onclick="selectPlan('trimestral', 199.90)">
                    ESCOLHER PLANO
                </button>
            </div>

            <div class="pricing-card">
                <div class="card-header">
                    <h3>ANUAL</h3>
                    <div class="price">
                        <span class="currency">R$</span>
                        <span class="amount">299</span>
                        <span class="cents">,90</span>
                    </div>
                    <div class="period">por ano</div>
                    <div class="savings">Economize 68%</div>
                </div>
                <ul class="features">
                    <li><i class="fas fa-check"></i> Tudo dos planos anteriores</li>
                    <li><i class="fas fa-check"></i> Recursos Exclusivos</li>
                    <li><i class="fas fa-check"></i> Suporte VIP 24/7</li>
                    <li><i class="fas fa-check"></i> Beta Access</li>
                </ul>
                <button class="btn btn-primary" onclick="selectPlan('anual', 299.90)">
                    ESCOLHER PLANO
                </button>
            </div>
        </div>

        <!-- Comparação de Recursos -->
        <div class="features-comparison">
            <h2>COMPARAÇÃO DE RECURSOS</h2>
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Recursos</th>
                            <th>Mensal</th>
                            <th>Trimestral</th>
                            <th>Anual</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Aim Assist Inteligente</td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Anti-detecção</td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Configurações Premium</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Suporte Prioritário</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Recursos Exclusivos</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Beta Access</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Segurança e Avaliações -->
        <div class="security-reviews">
            <h2>SEGURANÇA E AVALIAÇÕES</h2>
            
            <div class="security-badges">
                <div class="security-badge">
                    <i class="fas fa-shield-alt"></i>
                    <span>SSL Seguro</span>
                </div>
                <div class="security-badge">
                    <i class="fas fa-lock"></i>
                    <span>Pagamentos Seguros</span>
                </div>
                <div class="security-badge">
                    <i class="fas fa-certificate"></i>
                    <span>Site Verificado</span>
                </div>
            </div>

            <div class="customer-reviews">
                <h3>O que nossos clientes dizem:</h3>
                <div class="reviews-grid">
                    <div class="review">
                        <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Excelente produto! Suporte rápido e eficiente."</p>
                        <p class="author">- João Silva</p>
                    </div>
                    <div class="review">
                        <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"O melhor aim assist que já usei! Vale cada centavo."</p>
                        <p class="author">- Maria Santos</p>
                    </div>
                    <div class="review">
                        <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Anti-detecção funciona perfeitamente. Recomendo!"</p>
                        <p class="author">- Pedro Costa</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ -->
        <div class="faq-section">
            <h2>PERGUNTAS FREQUENTES</h2>
            <div class="faq-list">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>Como funciona o sistema anti-detecção?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Nosso sistema utiliza tecnologia avançada de bypass que é constantemente atualizada para evitar detecção pelos sistemas anti-cheat mais modernos.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>Posso cancelar minha assinatura a qualquer momento?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Sim, você pode cancelar sua assinatura a qualquer momento através do painel do usuário. Não há taxas de cancelamento.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>Qual é o tempo de resposta do suporte?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Nosso suporte responde em até 2 horas durante horário comercial. Clientes VIP têm prioridade e resposta em até 30 minutos.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal de Checkout -->
<div id="checkoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>FINALIZAR COMPRA</h3>
            <span class="close" onclick="closeCheckoutModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="loginPrompt" style="display: none;">
                <p>Faça login para continuar com a compra:</p>
                <div class="auth-buttons">
                    <a href="/login" class="btn btn-primary">Fazer Login</a>
                    <a href="/register" class="btn btn-secondary">Criar Conta</a>
                </div>
            </div>
            <div id="checkoutForm" style="display: none;">
                <div class="order-summary">
                    <h4>Resumo do Pedido</h4>
                    <div class="summary-item">
                        <span>Plano:</span>
                        <span id="selectedPlan"></span>
                    </div>
                    <div class="summary-item">
                        <span>Valor:</span>
                        <span id="selectedPrice"></span>
                    </div>
                </div>
                <button class="btn btn-primary btn-large" onclick="processPayment()">
                    <i class="fas fa-credit-card"></i>
                    PAGAR AGORA
                </button>
            </div>
            <div id="loadingPayment" style="display: none;">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Processando pagamento...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedPlanData = null;

function selectPlan(planType, price) {
    selectedPlanData = { type: planType, price: price };
    
    // Verificar se o usuário está logado
    const token = localStorage.getItem('access_token');
    
    if (!token) {
        // Mostrar modal de login
        document.getElementById('loginPrompt').style.display = 'block';
        document.getElementById('checkoutForm').style.display = 'none';
    } else {
        // Mostrar formulário de checkout
        document.getElementById('loginPrompt').style.display = 'none';
        document.getElementById('checkoutForm').style.display = 'block';
        
        // Atualizar resumo
        document.getElementById('selectedPlan').textContent = planType.toUpperCase();
        document.getElementById('selectedPrice').textContent = `R$ ${price.toFixed(2).replace('.', ',')}`;
    }
    
    // Abrir modal
    document.getElementById('checkoutModal').style.display = 'block';
}

function closeCheckoutModal() {
    document.getElementById('checkoutModal').style.display = 'none';
}

async function processPayment() {
    if (!selectedPlanData) return;
    
    const token = localStorage.getItem('access_token');
    if (!token) {
        showToast('Erro: Usuário não autenticado', 'error');
        return;
    }
    
    // Mostrar loading
    document.getElementById('checkoutForm').style.display = 'none';
    document.getElementById('loadingPayment').style.display = 'block';
    
    try {
        const response = await fetch('/api/mercadopago/create-preference', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                plan_id: selectedPlanData.type
            })
        });
        
        const data = await response.json();
        
        if (response.ok && data.init_point) {
            // Redirecionar para o Mercado Pago
            window.location.href = data.init_point;
        } else {
            throw new Error(data.detail || 'Erro ao processar pagamento');
        }
    } catch (error) {
        console.error('Erro no pagamento:', error);
        showToast('Erro ao processar pagamento: ' + error.message, 'error');
        
        // Voltar ao formulário
        document.getElementById('loadingPayment').style.display = 'none';
        document.getElementById('checkoutForm').style.display = 'block';
    }
}

function toggleFaq(element) {
    const faqItem = element.parentElement;
    const answer = faqItem.querySelector('.faq-answer');
    const icon = element.querySelector('i');
    
    faqItem.classList.toggle('active');
    
    if (faqItem.classList.contains('active')) {
        answer.style.maxHeight = answer.scrollHeight + 'px';
        icon.style.transform = 'rotate(180deg)';
    } else {
        answer.style.maxHeight = '0';
        icon.style.transform = 'rotate(0deg)';
    }
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
    const modal = document.getElementById('checkoutModal');
    if (event.target === modal) {
        closeCheckoutModal();
    }
}
</script>
{% endblock %}
