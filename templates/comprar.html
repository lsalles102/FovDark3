
{% extends "base.html" %}

{% block title %}Comprar - FovDark{% endblock %}

{% block content %}
<section class="purchase-section">
    <div class="container">
        <div class="purchase-header">
            <h1>ESCOLHA SEU PLANO</h1>
            <p>Domine o campo de batalha com precisão absoluta</p>
        </div>

        <div class="pricing-grid">
            <!-- Card Mensal -->
            <div class="pricing-card">
                <div class="card-header">
                    <h3>MENSAL</h3>
                    <div class="price">
                        <span class="currency">R$</span>
                        <span class="amount">79</span>
                        <span class="period">,90/mês</span>
                    </div>
                </div>
                
                <div class="card-body">
                    <ul class="pricing-features">
                        <li><i class="fas fa-check"></i> Aim Assist Inteligente</li>
                        <li><i class="fas fa-check"></i> Anti-Detecção Ativo</li>
                        <li><i class="fas fa-check"></i> Suporte via Discord</li>
                        <li><i class="fas fa-check"></i> Atualizações Gratuitas</li>
                        <li><i class="fas fa-check"></i> Configurações Básicas</li>
                    </ul>
                    
                    <button class="btn btn-primary btn-full" onclick="selectPlan('mensal', 79.90)">
                        <i class="fas fa-shopping-cart"></i>
                        ESCOLHER PLANO
                    </button>
                </div>
            </div>

            <!-- Card Trimestral (Mais Popular) -->
            <div class="pricing-card pricing-popular">
                <div class="popular-badge">MAIS POPULAR</div>
                <div class="card-header">
                    <h3>TRIMESTRAL</h3>
                    <div class="price">
                        <span class="currency">R$</span>
                        <span class="amount">199</span>
                        <span class="period">,90/3 meses</span>
                    </div>
                    <div class="savings">Economize 17%</div>
                </div>
                
                <div class="card-body">
                    <ul class="pricing-features">
                        <li><i class="fas fa-check"></i> Tudo do plano mensal</li>
                        <li><i class="fas fa-check"></i> Configurações Premium</li>
                        <li><i class="fas fa-check"></i> Suporte Prioritário</li>
                        <li><i class="fas fa-check"></i> Acesso Antecipado</li>
                        <li><i class="fas fa-check"></i> Recursos Avançados</li>
                    </ul>
                    
                    <button class="btn btn-primary btn-full" onclick="selectPlan('trimestral', 199.90)">
                        <i class="fas fa-crown"></i>
                        ESCOLHER PLANO
                    </button>
                </div>
            </div>

            <!-- Card Anual -->
            <div class="pricing-card">
                <div class="card-header">
                    <h3>ANUAL</h3>
                    <div class="price">
                        <span class="currency">R$</span>
                        <span class="amount">299</span>
                        <span class="period">,90/ano</span>
                    </div>
                    <div class="savings">Economize 68%</div>
                </div>
                
                <div class="card-body">
                    <ul class="pricing-features">
                        <li><i class="fas fa-check"></i> Tudo dos planos anteriores</li>
                        <li><i class="fas fa-check"></i> Recursos Exclusivos</li>
                        <li><i class="fas fa-check"></i> Suporte VIP 24/7</li>
                        <li><i class="fas fa-check"></i> Beta Access</li>
                        <li><i class="fas fa-check"></i> Configurações Elite</li>
                    </ul>
                    
                    <button class="btn btn-primary btn-full" onclick="selectPlan('anual', 299.90)">
                        <i class="fas fa-star"></i>
                        ESCOLHER PLANO
                    </button>
                </div>
            </div>
        </div>

        <!-- Seção de Recursos -->
        <div class="features-comparison">
            <h2>COMPARAÇÃO DE RECURSOS</h2>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Recursos</th>
                            <th>Mensal</th>
                            <th>Trimestral</th>
                            <th>Anual</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Aim Assist Inteligente</td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Anti-detecção</td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Configurações Premium</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Suporte Prioritário</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Recursos Exclusivos</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Beta Access</td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-times text-danger"></i></td>
                            <td><i class="fas fa-check text-success"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Badges de Segurança -->
        <div class="trust-badges">
            <div class="trust-item">
                <div class="trust-icon ssl">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="trust-info">
                    <h4>SSL Seguro</h4>
                    <p>Conexão criptografada</p>
                </div>
            </div>
            
            <div class="trust-item">
                <div class="trust-icon secure">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="trust-info">
                    <h4>Pagamentos Seguros</h4>
                    <p>Processamento confiável</p>
                </div>
            </div>
            
            <div class="trust-item">
                <div class="trust-icon verified">
                    <i class="fas fa-certificate"></i>
                </div>
                <div class="trust-info">
                    <h4>Site Verificado</h4>
                    <p>Empresa registrada</p>
                </div>
            </div>
            
            <div class="trust-item">
                <div class="trust-icon privacy">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="trust-info">
                    <h4>Privacidade</h4>
                    <p>Dados protegidos</p>
                </div>
            </div>
        </div>

        <!-- Avaliações dos Clientes -->
        <div class="reviews-section">
            <h2>AVALIAÇÕES DOS CLIENTES</h2>
            <div class="reviews-grid">
                <div class="review-card">
                    <div class="review-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                    <p class="review-text">"Excelente produto! O aim assist funciona perfeitamente e o suporte é muito rápido. Recomendo!"</p>
                    <div class="review-author">
                        <div class="author-avatar">JS</div>
                        <div class="author-info">
                            <div class="author-name">João Silva</div>
                            <div class="author-date">Há 2 dias</div>
                        </div>
                    </div>
                </div>

                <div class="review-card">
                    <div class="review-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                    <p class="review-text">"O melhor aim assist que já usei! Vale cada centavo investido. Sistema anti-detecção funciona perfeitamente."</p>
                    <div class="review-author">
                        <div class="author-avatar">MS</div>
                        <div class="author-info">
                            <div class="author-name">Maria Santos</div>
                            <div class="author-date">Há 1 semana</div>
                        </div>
                    </div>
                </div>

                <div class="review-card">
                    <div class="review-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                    <p class="review-text">"Produto incrível! Nunca fui detectado e minha precisão melhorou muito. Suporte técnico nota 10!"</p>
                    <div class="review-author">
                        <div class="author-avatar">PC</div>
                        <div class="author-info">
                            <div class="author-name">Pedro Costa</div>
                            <div class="author-date">Há 3 dias</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ -->
        <div class="faq-section">
            <h2>PERGUNTAS FREQUENTES</h2>
            <div class="faq-list">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>É SEGURO USAR O DARKFOV?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Sim. Nosso software utiliza tecnologia avançada de bypass que analisa automaticamente para evitar detecção. Mantemos nossos métodos privados para garantir máxima segurança.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>COMO FUNCIONA O SISTEMA DE LICENÇAS?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Após a compra, você recebe uma licença única vinculada ao seu e-mail. A licença é válida por 30, 90 ou 365 dias dependendo do plano escolhido.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>POSSO USAR EM MAIS DE UM COMPUTADOR?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Cada licença permite uso em até 2 computadores diferentes. Para mais dispositivos, será necessário adquirir licenças adicionais.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        <span>COMO RECEBO ATUALIZAÇÕES?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>As atualizações são automáticas e gratuitas durante todo o período da sua licença. Você será notificado quando uma nova versão estiver disponível.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal de Checkout -->
<div id="checkoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-shopping-cart"></i> FINALIZAR COMPRA</h3>
            <span class="close" onclick="closeCheckoutModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="loginPrompt" style="display: none;">
                <div class="auth-prompt">
                    <i class="fas fa-user-lock" style="font-size: 3rem; color: hsl(var(--primary)); margin-bottom: 1rem;"></i>
                    <h4>Acesso Necessário</h4>
                    <p>Faça login para continuar com a compra:</p>
                    <div class="auth-buttons">
                        <a href="/login" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i>
                            Fazer Login
                        </a>
                        <a href="/register" class="btn btn-secondary">
                            <i class="fas fa-user-plus"></i>
                            Criar Conta
                        </a>
                    </div>
                </div>
            </div>
            
            <div id="checkoutForm" style="display: none;">
                <div class="order-summary">
                    <h4><i class="fas fa-receipt"></i> Resumo do Pedido</h4>
                    <div class="summary-item">
                        <span>Plano:</span>
                        <span id="selectedPlan" class="plan-name"></span>
                    </div>
                    <div class="summary-item total">
                        <span>Total:</span>
                        <span id="selectedPrice" class="price-value"></span>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-large" onclick="processPayment()">
                    <i class="fas fa-credit-card"></i>
                    PAGAR AGORA
                </button>
                
                <div class="payment-security">
                    <p><i class="fas fa-shield-alt"></i> Pagamento 100% seguro via Mercado Pago</p>
                </div>
            </div>
            
            <div id="loadingPayment" style="display: none;">
                <div class="loading-container">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <h4>Processando Pagamento</h4>
                    <p>Aguarde enquanto redirecionamos você para o Mercado Pago...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedPlanData = null;

function selectPlan(planType, price) {
    selectedPlanData = { type: planType, price: price };
    
    // Verificar se o usuário está logado
    const token = localStorage.getItem('access_token');
    
    if (!token) {
        // Mostrar modal de login
        document.getElementById('loginPrompt').style.display = 'block';
        document.getElementById('checkoutForm').style.display = 'none';
    } else {
        // Mostrar formulário de checkout
        document.getElementById('loginPrompt').style.display = 'none';
        document.getElementById('checkoutForm').style.display = 'block';
        
        // Atualizar resumo
        document.getElementById('selectedPlan').textContent = planType.toUpperCase();
        document.getElementById('selectedPrice').textContent = `R$ ${price.toFixed(2).replace('.', ',')}`;
    }
    
    // Abrir modal
    document.getElementById('checkoutModal').style.display = 'flex';
}

function closeCheckoutModal() {
    document.getElementById('checkoutModal').style.display = 'none';
}

async function processPayment() {
    if (!selectedPlanData) return;
    
    const token = localStorage.getItem('access_token');
    if (!token) {
        showToast('Erro: Usuário não autenticado', 'error');
        return;
    }
    
    // Mostrar loading
    document.getElementById('checkoutForm').style.display = 'none';
    document.getElementById('loadingPayment').style.display = 'block';
    
    try {
        const response = await fetch('/api/mercadopago/create-preference', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                plan_id: selectedPlanData.type
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            // Redirecionar para página de sucesso (simulação)
            const initPoint = data.init_point || data.sandbox_init_point;
            if (initPoint) {
                window.location.href = initPoint;
            } else {
                showToast('Erro ao gerar link de pagamento', 'error');
                document.getElementById('loadingPayment').style.display = 'none';
                document.getElementById('checkoutForm').style.display = 'block';
            }
        } else {
            throw new Error(data.detail || 'Erro ao processar pagamento');
        }
    } catch (error) {
        console.error('Erro no pagamento:', error);
        showToast('Erro ao processar pagamento: ' + error.message, 'error');
        
        // Voltar ao formulário
        document.getElementById('loadingPayment').style.display = 'none';
        document.getElementById('checkoutForm').style.display = 'block';
    }
}

function toggleFaq(element) {
    const faqItem = element.parentElement;
    const answer = faqItem.querySelector('.faq-answer');
    const icon = element.querySelector('i');
    
    // Fechar outros FAQs
    document.querySelectorAll('.faq-item').forEach(item => {
        if (item !== faqItem && item.classList.contains('active')) {
            item.classList.remove('active');
            item.querySelector('.faq-answer').style.maxHeight = '0';
            item.querySelector('.faq-question i').style.transform = 'rotate(0deg)';
        }
    });
    
    // Toggle atual
    faqItem.classList.toggle('active');
    
    if (faqItem.classList.contains('active')) {
        answer.style.maxHeight = answer.scrollHeight + 'px';
        icon.style.transform = 'rotate(180deg)';
    } else {
        answer.style.maxHeight = '0';
        icon.style.transform = 'rotate(0deg)';
    }
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
    const modal = document.getElementById('checkoutModal');
    if (event.target === modal) {
        closeCheckoutModal();
    }
}

// Animações ao carregar
document.addEventListener('DOMContentLoaded', function() {
    // Animar cards de pricing
    const cards = document.querySelectorAll('.pricing-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.classList.add('animate-slide-up');
        }, index * 200);
    });
});
</script>
{% endblock %}
